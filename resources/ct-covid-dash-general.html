<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>City of Cape Town Covid-19 General Management Dashboard</title>

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/ct-covid-dash.css">
    <script src="assets/js/lazysizes.min.js" async=""></script>
</head>

<body class="bg-dark">

<video id="backgroundVideo" autoplay="autoplay" muted="muted" loop="loop">
    <source id="backgroundVideoSrc" src="" type="video/mp4">
</video>

<div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-fixed-top" id="navbar">
        <a class="navbar-brand" href="ct-covid-dash-city.html">
            <img src="./assets/imgs/rect_city_logo.png" alt="" height="50">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span
                class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active"><a class="nav-link" href="ct-covid-dash-general.html">City</a></li>
                <li class="nav-item active dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                       aria-haspopup="true" aria-expanded="false">Directorate</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="#opening">Covid-19 Information</a>
                        <div role="separator" class="dropdown-divider"></div>
                        {% for directorate_title, directorate_filename_prefix, _, _ in directorate_tuples -%}
                        <a class="dropdown-item" href="#{{ directorate_filename_prefix }}">{{ directorate_title }} </a>
                        {% endfor -%}
                    </div>
                </li>
                <li class="nav-item"><a class="nav-link" href="ct-covid-dash-sa.html">South Africa</a></li>
                <li class="nav-item"><a class="nav-link" href="ct-covid-dash-int.html">International</a></li>
            </ul>
        </div>
    </nav>
</div>

<div class="container" id="overlay" data-spy="scroll" data-target="#navbar" data-offset="0">
    <div id="opening" class="container">
        <div class="row mt-2 rows-cols-2" style="height: 75vh">
            <div class="col h-100">
                <div class="container-fluid h-100">
                    <div class="row" style="height:49%" id="cityCasesPlot"></div>
                    <div class="row" style="height:2%"></div>
                    <div class="row" style="height:49%" id="provincialForecast"></div>
                </div>
            </div>

            <div class="col h-100" id="mapCard"></div>
        </div>

        <div class="container" id="casesOverTime">
            <div class="row mt-2 row-cols-2">
                <div class="col pl-0" style="height:30rem" id="cityNewCaseChart"></div>

                <div class="col pr-0" style="height:30rem" id="cityDemographicChart"></div>
            </div>
        </div>

    </div>

    {% for directorate_title, directorate_filename_prefix, sr_flag, hr_flag in directorate_tuples %}
    <!-- {{ directorate_title }} -->
    <div id="{{ directorate_filename_prefix }}" class="container mt-2 pt-2 border-top">
        <h2> {{ directorate_title}} </h2>
        {% set num_cols = 1 %}
        {% set num_cols = num_cols + (1 if sr_flag else 0) %}
        {% set num_cols = num_cols + (1 if hr_flag else 0) %}
        {% set col_width = 10 if num_cols == 2 else 5 %}
        <div class="row row-cols-{{ num_cols }}" style="height:30rem">
            <div class="col-2 pr-1 h-100 w-100 pr-2" id="stats_{{ directorate_filename_prefix }}">
                <div class="row w-100" style="height:30%">
                    <div class="card border-light bg-info w-100 h-100">
                        <img src="assets/imgs/cogs-solid.svg" class="card-img h-100"
                             style="opacity: 0.2">
                        <div class="card-img-overlay">
                            <h4 class="card-title" id="working_{{directorate_filename_prefix}}">Loading...</h4>
                            <p class="card-text ">Staff Working</p>
                        </div>
                    </div>
                </div>

                <div class="row w-100" style="height:5%"></div>

                <div class="row w-100" style="height:30%">
                    <div class="card border-light bg-info w-100 h-100">
                        <img src="assets/imgs/clipboard-regular.svg" class="card-img h-100"
                             style="opacity: 0.2">
                        <div class="card-img-overlay">
                            <h4 class="card-title" id="assessed_{{directorate_filename_prefix}}">Loading...</h4>
                            <p class="card-text ">Staff Assessed</p>
                        </div>
                    </div>
                </div>

                <div class="row w-100" style="height:5%"></div>

                <div class="row w-100" style="height:30%">
                    <div class="card border-light bg-info w-100 h-100">
                        <img src="assets/imgs/clock-regular.svg" class="card-img h-100"
                             style="opacity: 0.2">
                        <div class="card-img-overlay">
                            <h4 class="card-title" id="duration_{{directorate_filename_prefix}}">Loading...</h4>
                            <p class="card-text ">SR Duration</p>
                        </div>
                    </div>
                </div>
            </div>
            {% if sr_flag -%}
            <div class="col-{{ col_width }} pl-2 {{ 'pr-2' if hr_flag else ''}} h-100"
                 id="serviceRequestTimeSeries_{{ directorate_filename_prefix }}"></div>
            {% endif -%}
            {% if hr_flag -%}
            <div class="col-{{ col_width }} {{ 'pl-2' if sr_flag else ''}} h-100"
                 id="hRTimeSeries_{{ directorate_filename_prefix }}"></div>
            {% endif -%}
        </div>
    </div>
    {% endfor %}

    <div id="footerPlaceholder"></div>
</div>

<!-- bootstrap scripts -->
<script src="assets/js/jquery-3.4.1.min.js"></script>

<!-- custom code for dynamically updating data -->
<script src="assets/js/update_dash.js"></script>
<script>
    $(() => {
        // General
        addCard("cityCasesPlot", "widgets/private/ct_cumulative_daily_counts_bar_chart.html",
          'City Cases over Time <small><a class="text-white" href="#casesOverTime">(<u>more detail</u>)</a></small>');

        addCard("mapCard", "widgets/private/city_map_widget.html", "City Case Counts over Space");

        addCard("cityDemographicChart", "widgets/private/cct_demographic_case_fatality_plot.html",
            "City Confirmed Percentage by Age");
        addCard("provincialForecast", "widgets/private/wc_model_latest_disease_figures.html",
            "WC Health Dept. Disease Forecast <br/><small>as of 2020-04-29</small>");

        addCard("cityNewCaseChart", "widgets/private/ct_daily_counts_bar_chart.html", "New City Cases over Time");

        addFooter("footerPlaceholder");

        // Directorate Specific
        {%- for directorate_title, directorate_filename_prefix, sr_flag, hr_flag in directorate_tuples %}
        // {{ directorate_title }}
        {% if sr_flag -%}
        addCard("serviceRequestTimeSeries_{{ directorate_filename_prefix }}",
                "widgets/private/business_continuity_{{ directorate_filename_prefix }}_service_request_count_plot.html",
                "Service Request Volumes over Time");
        {% endif -%}
        {% if hr_flag -%}
        addCard("hRTimeSeries_{{ directorate_filename_prefix }}",
                "widgets/private/business_continuity_{{ directorate_filename_prefix }}_hr_absenteeism_plot.html",
                "HR Capacity over Time");
        {% endif -%}
        {% endfor %}

        setTimeout(function() {
            addBackgroundVideoSrc("backgroundVideoSrc", "backgroundVideo", "assets/imgs/ct_timelapse_above.mp4");
        }, 10000);
    });
</script>

<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

</body>

</html>