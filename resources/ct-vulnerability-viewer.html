<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>City of Cape Town Covid-19 Vulnerability Data Viewer</title>
    <link rel="icon"
          type="image/png"
          href="assets/imgs/favicon.png">

    <link rel="stylesheet" href="assets/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/ct-covid-dash.css">
    <script src="assets/js/lazysizes.min.js" async=""></script>
</head>

<body class="bg-dark">

<video id="backgroundVideo" autoplay="autoplay" muted="muted" loop="loop">
    <source id="backgroundVideoSrc" src="" type="video/mp4">
</video>

<div id="wrapper" class="row p-0">
    <div id="sidebar"
         class="navbar navbar-light p-0 align-items-start justify-content-start h-100 collapse show">
        <ul class="nav flex-column w-100 px-2 nav-pills nav-fill">
            <button id="bigBrand" class="btn navbar-brand h-100 w-100" type="button" style="height:75px"
                    data-toggle="collapse" data-target="#sidebar" aria-expanded="true">
                <img src="./assets/imgs/rect_city_logo.png" class="h-100 align-middle" alt=""
                     style="max-height:75px">
            </button>
            <button id="littleBrand" class="btn navbar-brand h-100 w-100" type="button" style="height:75px"
                    data-toggle="collapse" data-target="#sidebar" aria-expanded="true">
                <img src="./assets/imgs/city_emblem.png" class="h-100 align-middle" alt=""
                     style="max-height:75px">
            </button>
            <!-- Pandemic Info -->
            <li class="nav-item">
                <a class="iconLink nav-link w-100 text-center" href="#epidemiologicalSection">
                    <h2><i class="fas fa-viruses"></i></h2>
                </a>
            </li>
            <li class="nav-item">
                <a class="btn collapsed text-left h4 w-100" href="#subdistrictCollapse" data-toggle="collapse"
                   role="button" aria-expanded="false" aria-controls="subdistrictCollapse">
                    <span class="sectionExpand"><span class="expandControl">▼</span> Health Subdistricts</span>
                </a>
            </li>
            <div class="collapse" id="subdistrictCollapse">
                {% for district_name, district_filename_prefix in district_tuples -%}
                    <li class="nav-item active">
                        <a class="nav-link ml-3 my-1 h7 w-100"
                           href="#{{ district_filename_prefix }}">{{ district_name }}</a>
                    </li>
                {% endfor -%}
            </div>

            <!-- SocioEconomic Vulnerability -->
            <li class="nav-item">
                <a class="iconLink nav-link w-100 text-center" href="#socioEconomicVulnerabilitySection">
                    <h2><i class="fas fa-hands-helping"></i></h2>
                </a>
            </li>
            <li class="nav-item">
                <a class="btn collapsed text-left h4 w-100" href="#socioEconomicVulnerabilityCollapse"
                   data-toggle="collapse" role="button"
                   aria-expanded="false" aria-controls="socioEconomicVulnerabilityCollapse">
                    <span class="sectionExpand"><span class="expandControl">▼</span> Subcouncils</span>
                </a>
            </li>
            <div class="collapse" id="socioEconomicVulnerabilityCollapse">
                {% for subdistrict in subdistrict_tuples -%}
                    <li class="nav-item active">
                        <a class="nav-link ml-3 my-1 h7 w-100" href="#{{ None }}">{{ None }}</a>
                    </li>
                {% endfor -%}
            </div>

            <!-- City Ops -->
            <li class="nav-item">
                <a class="iconLink nav-link w-100 text-center" href="#serviceDeliverySection">
                    <h2><i class="fas fa-city"></i></h2>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link ml-3 my-1 h7 sectionExpand" href="#citySDT">
                    <span>Service Delivery Turnaround</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="btn collapsed text-left h4 w-100" href="#serviceDeliveryCollapse" data-toggle="collapse"
                   role="button"
                   aria-expanded="false" aria-controls="serviceDeliveryCollapse">
                    <span class="sectionExpand"><span class="expandControl">▼</span> Directorates</span>
                </a>
            </li>
            <div class="collapse" id="serviceDeliveryCollapse">
                {% for directorate_title, directorate_filename_prefix, sr_flag, hr_flag, depts_tuple in
                directorate_tuples -%}
                    <li class="nav-item active">
                        <a class="nav-link ml-3 my-1 h7"
                           href="#{{ directorate_filename_prefix }}">{{ directorate_title }} </a>
                    </li>
                {% endfor -%}
            </div>
        </ul>
    </div>

    <div class="container-fluid py-0 pl-0 pr-3 col h-100" id="overlayWithSidebar" data-spy="scroll"
         data-target="#sidebar" data-offset="0">
        <div class="row row-cols-1 py-0 px-3">
            <div class="col" id="disclaimer"></div>
        </div>

        <div class="row row-cols-1 py-0 px-3">
            <div class="col" id="betaDisclaimer"></div>
        </div>

        <div id="epidemiologicalSection" class="container-fluid py-0 px-3">
            <h2>Covid-19</h2>
            <div class="row row-cols-4 mt-1 py-0" style="min-height:6rem;height:8vh">
                <div class="col h-100 w-100" id="lastUpdatedStatCard"></div>
                <div class="col h-100 w-100" id="sATestedStatCard"></div>
                <div class="col h-100 w-100" id="casesStatCard"></div>
                <div class="col h-100 w-100" id="deathsStatCard"></div>
            </div>

            <div class="row mt-2 rows-cols-2" style="height: 45vh">
                <div class="col pr-1 h-100" id="cityNewCaseChart"></div>
                <div class="col pl-1 h-100" id="fatalityForecast"></div>
            </div>

            <div class="row row-cols-1 mt-2 px-3" id="tableCard" style="height: 31em"></div>

            <div class="row mt-2 row-cols-2" style="height:30rem">
                <div class="col pr-1 h-100" id="cityCasesPlot"></div>
                <div class="col pl-1 h-100" id="cityDeathsPlot"></div>
            </div>
            <div class="row mt-2 row-cols-2" style="height:30rem">
                <div class="col pr-1 h-100" id="cityGenAdmissionsPlot"></div>
                <div class="col pl-1 h-100" id="cityIcuAdmissionsPlot"></div>
            </div>

            {%- for district_name, district_filename_prefix in district_tuples %}
                <!-- {{ district_name }} -->
                <div id="{{ district_filename_prefix }}" class="container-fluid mt-2 pt-2 border-top px-3">
                    {% set district_title = district_name.title().replace(" ", "_") %}
                    {% set plot_prefix = "cct_City_of_Cape_Town_-_" + district_title %}

                    <div class="row mt-1 rows-cols-4 px-3" style="min-height:6rem;height:8vh"
                         id="stats_{{ district_filename_prefix }}">
                        <div class="col h-100">
                            <div class="row h-25"></div>
                            <div class="row text-center">
                                <div class="btn text-white collapsed" data-toggle="collapse"
                                     href="#{{ district_filename_prefix }}_Expanded"
                                     role="button" aria-expanded="false"
                                     aria-controls="{{ district_filename_prefix }}_Expanded">
                                    <h2><span class="expandControl">▼</span> {{ district_name }} </h2>
                                </div>
                            </div>
                            <div class="row h-25"></div>
                        </div>
                        <div class="col h-100" id="cumulativeCases_{{ district_filename_prefix }}"></div>
                        <div class="col h-100" id="activeCases_{{ district_filename_prefix }}"></div>
                        <div class="col h-100" id="cumulativeDeaths_{{ district_filename_prefix }}"></div>
                    </div>

                    <div class="row mt-2 rows-cols-2 px-3 collapse" style="height:60vh"
                         id="{{ district_filename_prefix }}_Expanded">
                        <div class="col pl-1 h-100"
                             id="{{ plot_prefix }}_DailyCounts"></div>
                        <div class="col pl-1 pr-0 h-100"
                             id="{{ plot_prefix }}_CumulativeCount"></div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div id="socioEconomicVulnerabilitySection" class="container-fluid mt-2 pt-2 border-top px-3"
             data-spy="scroll" data-target="#navbar" data-offset="0">
            <h2>Socio-economic Vulnerability</h2>
            <h3>Spatial Vulnerability</h3>
            <div class="row h-100 mt-2 rows-cols-2" id="mapCardInfo">
                <div class="col w-100 pr-1">
                    <a class="btn btn-info w-100 border-light" data-toggle="collapse" href="#userGuideCollapse"
                       role="button"
                       aria-expanded="false"
                       aria-controls="userGuideCollapse" style="height: 6vh; min-height:40px" id="userGuideButton">
                        Spatial Data User Guide
                    </a>
                </div>
                <div class="col w-100 pl-1">
                    <a class="btn btn-info w-100 border-light" data-toggle="collapse" href="#metadataCollapse"
                       role="button"
                       aria-expanded="false"
                       aria-controls="userGuideCollapse" style="height: 6vh; min-height:40px" id="metadataButton">
                        Spatial Data Metadata
                    </a>
                </div>
            </div>

            <div class="h-100 mt-0 rows-cols-1">
                <div class="col collapse w-100 pr-3 pl-0" id="userGuideCollapse">
                    <div class="card card-body text-dark h-100 w-100">
                        <p>
                            <a target="_blank"
                               href="https://collaborate.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/UserGuide/Vulnerablility%20viewer_user%20guide.pptx?d=wdd6726fcc1cf4a008c81530c3780bb01">
                                Click here for illustrated User Guide
                            </a>
                        </p>
                        <p>
                            <strong> Brief Notes:</strong>
                        <ul>
                            <li><strong>Caution</strong>: Case data on hex level is incomplete (see incompleteness
                                level
                                in bottom left corner)
                            </li>
                            <li><strong>Caution</strong>: Socio-Economic Vulnerability Index WCPG (2020) - Large
                                enumeration areas north of Blaauwberg and east of Atlantis likely reflect
                                incorrectly
                                large areas with high vulnerability.
                            </li>
                            <li>Layers will display in order added (i.e. unselect and reselect a layer to bring to
                                top)
                            </li>
                            <li>The data is sorted in different vulnerability themes, which are capitalised (e.g.
                                POPULATION DENSITY). The ticks next to the vulnerability theme controls the layers
                                immediately below.
                            </li>
                            <li>We advise that you don't use more than 2 or 3 layers at one time.</li>
                            <li>Base map detail (e.g. suburb and street names) appear as you zoom in.</li>
                            <li>Use the expand link (the arrow in top right corner) to open in a new tab.</li>
                            <li>You can stop the background video by right clicking on it, outside of the dark
                                overlay.
                                Select Pause or Stop (depending on your browser) in the menu that appears.
                            </li>
                        </ul>
                        </p>
                    </div>
                </div>
            </div>
            <div class="h-100 mt-0 rows-cols-1">
                <div class="col collapse w-100 pl-3 pr-0" id="metadataCollapse">
                    <div class="card card-body text-dark h-100 w-100">
                        <ul>
                            <li><strong>Active Covid-19 cases (hexes):</strong> Last 14 days' positive cases per
                                Health
                                Hex. Refer to red text in bottom left for level of
                                completeness (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_hex_l8_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>Active Covid-19 cases (district):</strong> Last 14 days' positive cases per
                                Health
                                District. Refer to red text in bottom left for level of completeness (WCPG Dept of
                                Health,
                                updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_district_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>Active Covid-19 cases changes (district):</strong> The change in number of
                                active
                                cases (see definition above) against the previous week's active cases per Health
                                District.
                                A 3 day delay is introduced to allow for incomplete reporting of recent cases. Refer
                                to
                                red
                                text in bottom left for level of completeness
                                (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_district_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>All Covid-19 (hexes):</strong> Cumulative positive cases with traceable
                                addresses.
                                Refer to red text in bottom left for level of
                                completeness (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_hex_l8_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>All Covid-19 (districts):</strong> Cumulative positive cases per Health
                                District.
                                Refer to red text in bottom left for level of
                                completeness (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_district_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>All Covid-19 cases changes (district):</strong> The increase in the number
                                of
                                positive cases against the previous week's total per Health District.
                                A 3 day delay is introduced to allow for incomplete reporting of recent cases. Refer
                                to
                                red
                                text in bottom left for level of completeness
                                (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_district_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>Covid-19 Mortality (hexes):</strong> Cumulative deceased with traceabe
                                addresses.
                                Refer to red text in bottom left for level of
                                completeness (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_hex_l8_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>Covid-19 Mortality (district):</strong> Cumulative deceased per Health
                                District.
                                Refer to red text in bottom left for level of
                                completeness (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_district_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>All Covid-19 mortality changes (district):</strong> The increase in the
                                number
                                of
                                deaths against the previous week's total per Health District. A 3 day delay is
                                introduced
                                to allow for incomplete reporting. Refer to red text in bottom left for level of
                                completeness
                                (WCPG Dept of Health, updated daily, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_district_case_count.geojson'>Download
                                    link</a></li>
                            <li><strong>Health District:</strong> WCPG Dept. of Health sub-district names for City
                                of
                                Cape
                                Town District.
                                (WCPG Dept of Health, static, 2020). <a
                                        href='widgets/private/case_count_maps/health_districts.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>Healthcare Facilities:</strong> Hospitals and clinics, both public and
                                private
                                (CoCT
                                Health & WCPG Dept Health, static, 2020). <a
                                        href='widgets/private/case_count_maps/health_care_facilities.geojson'>Download
                                    link</a></li>
                            <li><strong>Official Suburbs:</strong> Official City Suburbs (CoCT Corporate GIS,
                                static,
                                2020).
                                <a href='widgets/private/case_count_maps/official_suburbs.geojson'>Download link</a>
                            </li>
                            <li><strong>2019 Population Estimate:</strong> Draft Land Use Model baseline. (CoCT
                                Urban
                                Planning and Design, static, 2020). <a
                                        href='widgets/private/case_count_maps/sl_du_pop_est_2019_hex9.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>WCPG SEVI:</strong> Socio-Economic Vulnerability Index (WCPG, static, 2020).
                                <a
                                        href='widgets/private/case_count_maps/province_sevi_hex9.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>WCED Schools:</strong> Western Cape Education department Schools (WCPG
                                Education
                                Dept, static, 2019). <a
                                        href='widgets/private/case_count_maps/wced_metro_schools_2019.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>Shopping Centres (>5k m²):</strong> Shopping centres larger than 5000 m²
                                (South
                                African Council of Shopping Centres, static, 2020). <a
                                        href='widgets/private/case_count_maps/shopping_centres_above_5000sqm_rode_2020.geojson'>Download
                                    link</a></li>
                            <li><strong>Public Transport Interchanges:</strong> CoCT Interchanges of bus, taxi,
                                train or
                                park & ride (CoCT Transport, static, 2018). <a
                                        href='widgets/private/case_count_maps/public_transport_interchanges.geojson'>Download
                                    link</a></li>
                            <li><strong>Public Transport Activity:</strong> Concentrations of public transport users
                                (CoCT
                                Transport, static, 2018). <a
                                        href='widgets/private/case_count_maps/public_transport_activity_levels_hex9.geojson'>Download
                                    link</a></li>
                            <li><strong>Mobile Device Activity Increase:</strong> Increases of mobile phone
                                activity,
                                during
                                the day (8am to 7pm) relative to the night (Mobile Network and CoCT Data Science,
                                updated
                                weekly, 2020). <a
                                        href='widgets/private/case_count_maps/city_all_hex_l8_mobile_count.geojson'>Download
                                    link</a></li>
                            <li><strong>Trading locations:</strong> Licensed informal trading areas, excludes
                                unlicensed trading (static, 2019). <a
                                        href='widgets/private/case_count_maps/trading_location.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>SASSA Offices:</strong> SASSA Office locations (SASSA, static, 2020). <a
                                    href='widgets/private/case_count_maps/sassa_local_office_coc.geojson'>Download
                                link</a>
                            </li>
                            <li><strong>SASSA Paypoint (Shops):</strong> Retail shops used for payment of SASSA
                                grants
                                (SASSA, static, 2020). <a
                                        href='widgets/private/case_count_maps/retail_stores.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>Employer Sample:</strong> Detailed employment data as part of employment
                                density
                                survey (CocT Transport Planning, static, 2018). <a
                                        href='widgets/private/case_count_maps/employment_density_survey_20200515.geojson'>Download
                                    link</a></li>
                            <li><strong>Employment Density:</strong> Employment density by transport zone (CocT
                                Transport
                                Planning, static, 2018). <a
                                        href='widgets/private/case_count_maps/employment_density_survey_hex7.geojson'>Download
                                    link</a></li>
                            <li><strong>Rental Stock (houses):</strong> CoCT managed houses. (CoCT Public Housing,
                                static,
                                2020) <a
                                        href='widgets/private/case_count_maps/city_house_counts.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>Rental Stock (flats):</strong> CoCT managed flats. (CoCT Public Housing,
                                static,
                                2020)<a
                                        href='widgets/private/case_count_maps/city_flats_counts.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>Rental stock (hostels):</strong> CoCT managed hostels. (CoCT Public Housing,
                                static,
                                2020)<a
                                        href='widgets/private/case_count_maps/city_hostel_counts.geojson'>Download
                                    link</a>
                            </li>
                            <li><strong>Areas of Informality:</strong> Informal settlements and other areas with
                                informal structures (CoCT Informal Settlements, static, 2019). <a
                                        href='widgets/private/case_count_maps/areas_of_informality_2019.geojson'>Download
                                    link</a></li>
                            <li><strong>Elderly Population Density:</strong> Population density estimates of those
                                older
                                than 55. Uses household characteristics as of 2011. (CoCT Synthetic population
                                project
                                initial results, static, 2020). <a
                                        href='widgets/private/case_count_maps/cpop_gt55.geojson'>Download
                                    link</a></li>
                            <li><strong>Old Age Facilitites:</strong> Older Persons homes. (CoCT
                                Environmental Health & WCPG Dept Soc Serv; CoCT Valuations Department, static,
                                2020). <a
                                        href='widgets/private/case_count_maps/olderpersons_res_fac_cct.geojson'>Download
                                    link</a></li>
                            <li><strong>Adult Homeless Shelters:</strong> Registered homeless shelters (WCPG Dept
                                Soc
                                Dev,
                                static, 2019). <a
                                        href='widgets/private/case_count_maps/adult_homeless_shelters_coct.geojson'>Download
                                    link</a></li>
                            <li><strong>Community-based Teams:</strong> (CoCT Urban Management, static, 2020). <a
                                    href='widgets/private/case_count_maps/coct_cbt.geojson'>Download link</a></li>
                            <li><strong>Community Action Networks:</strong> (CoCT Urban Planning and Design, static,
                                2020).
                                <a href='widgets/private/case_count_maps/ct_cans.geojson'>Download link</a></li>
                            <li><strong>NGO/NPOs:</strong> (CoCT Resilience, static, 2020).
                                <a href='widgets/private/case_count_maps/npo_publish_data.geojson'>Download link</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="row row-cols-1 mt-2 px-3" style="height: 90vh" id="mapCard"></div>

            <div class="row h-100 mt-2 rows-cols-1 px-3" id="report">
                <div class="col w-100 px-0">
                    <a class="btn btn-info w-100 border-light" data-toggle="collapse" href="#reportCollapse"
                       role="button"
                       aria-expanded="false"
                       aria-controls="reportsCollapse" style="height: 4vh; min-height:40px" id="reportsButton">
                        Weekly Reports
                    </a>
                </div>
            </div>

            <div class="h-100 mt-0 rows-cols-1">
                <div class="col collapse w-100 pr-1 pl-1" id="reportCollapse">
                    <div class="card card-body text-dark h-100 w-100">
                        <p>
                            <strong>Weekly Reports:</strong>
                        <ul>
                            <li>
                                <a target="_blank"
                                   href="https://collaborate.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/09072020%20Weekly%20Health%20Data%20Feedback.pdf?d=wd410de975555467e92a7563e34321a5b">
                                    2020-07-09
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="https://collaborate.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/16072020%20Weekly%20Health%20Data%20Feedback.pdf?d=w277888829dbb42fab4a20b039e9f88a2">
                                    2020-07-16
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="https://collaborate.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/23072020%20Weekly%20Health%20Data%20Feedback.pdf?d=w333749c585dc4e5da453f6227d8108d4">
                                    2020-07-23
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="https://collaborate.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/30072020%20Weekly%20Health%20Data%20Feedback.pdf?d=w585b06d8d3624c0faee8fde72c780eba">
                                    2020-07-30
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/06082020%20Weekly%20Health%20Data%20Feedback.pdf?d=wfd128c460c8f4f7b992fb3a90cc8e7c3">
                                    2020-08-06
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200813%20Weekly%20Health%20Data%20Feedback.pdf?d=w85032118c19146859504bb79837cbd47">
                                    2020-08-13
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200820%20Weekly%20Health%20Data%20Feedback.pdf?d=wf573bd9c6270448381a04defe67c2e72">
                                    2020-08-20
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200827%20Weekly%20Health%20Data%20Feedback.pdf?d=w2e404717d58c42dda70b066c024667e0">
                                    2020-08-27
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200901%20Weekly%20Health%20Data%20Feedback.pdf?d=w2641938afa4a470ea3d4f75bf01975d6">
                                    2020-09-01
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200908%20Weekly%20Health%20Data%20Feedback.pdf?d=w1df9024e22bb476393bb731f2ee0678b">
                                    2020-09-08
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200914%20Weekly%20Health%20Data%20Feedback.pdf?d=we12334e1dd774b90857a6aa17da06ed1">
                                    2020-09-14
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20200921%20Weekly%20Health%20Data%20Feedback.pdf?d=w9fae66331f2d4d66b6eda761a97393f2">
                                    2020-09-21
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20201005%20Weekly%20Health%20Data%20Feedback.pdf?d=wd02845a5eb8a4919a99d21f72aa80a69">
                                    2020-10-05
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20201015_specialDCT%20meeting.pptx?d=w0d996c54fa3846db8d3b18ec84a568a1">
                                    2020-10-15
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20201019%20Weekly%20Health%20Data%20Feedback%20.pdf?d=w8468f04ce1f5411791c788536427ea3f">
                                    2020-10-19
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="http://teamsites.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20201115%20Weekly%20Health%20Data%20Feedback%20.pdf?d=w8889c7cc7abd4b8aadfe1e7071493a05">
                                    2020-11-15
                                </a>
                            </li>
                            <li>
                                <a target="_blank"
                                   href="https://collaborate.capetown.gov.za/sites/IDPOPMts/Data%20Science/Covid-19/VulnerabilityViewer/Reports/20201214%20Weekly%20Health%20Data%20Feedback.pdf?d=wda530bc8cb8d4c239331e9a4ebb68d2c">
                                    2020-12-14
                                </a>
                            </li>
                        </ul>
                        </p>
                    </div>
                </div>
            </div>

            <h3 class="mt-2">Socio-economic Indicators</h3>
            <div class="row row-cols-4 mt-1 py-0" style="min-height:7rem;height:7vh">
                <div class="col h-100 w-100" id="lastUpdatedSocioeconomicStatCard"></div>
                <div class="col h-100 w-100" id="gdpStatCard"></div>
                <div class="col h-100 w-100" id="unemploymentStatCard"></div>
                <div class="col h-100 w-100" id="povertyStatCard"></div>
            </div>

            <div class="row row-cols-1 mt-2 px-3" id="socioEconomicTimeseriesCard" style="height: 35em"></div>

        </div>

        <div id="serviceDeliverySection" class="container-fluid mt-2 pt-2 border-top px-3">
            <h2>Service Delivery</h2>
            <h3>Service Delivery Turnaround Program</h3>
            <div id="citySDT" class="container-fluid mt-2 pt-2 border-top px-3">
                <div class="row row-cols-4 mt-1 py-0" style="min-height:7rem;height:7vh">
                    <div class="col h-100">
                        <div class="row h-3"></div>
                        <div class="row">
                            <div class="btn text-white collapsed text-left" data-toggle="collapse"
                                 href="#citySDT_Expanded"
                                 role="button" aria-expanded="false"
                                 aria-controls="citySDT_Expanded">
                                <h1 class="text-left"><span class="expandControl">▼</span>
                                    <span>Citywide</span></h1>
                            </div>
                        </div>
                        <div class="row h-3"></div>
                    </div>
                    <div class="col h-100 w-100" id="serviceDeliveryBacklog_citySDT"></div>
                    <div class="col h-100 w-100" id="serviceDeliveryLongBacklog_citySDT"></div>
                    <div class="col h-100 w-100" id="serviceDeliveryStandard_citySDT"></div>
                </div>

                <div class="mt-2 px-3 collapse" style="height:60vh" id="citySDT_Expanded">
                    <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                        <div class="col h-100 pl-0"
                             id="serviceDeliveryVolumeTimeSeries_citySDT"></div>
                        <div class="col h-100 pr-0"
                             id="serviceDeliveryBacklogTimeSeries_citySDT"></div>
                    </div>
                    <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                        <div class="col h-100 pl-0"
                             id="serviceDeliveryAgeAnalysis_citySDT"></div>
                        <div class="col h-100 pr-0"
                             id="serviceDeliveryLongBacklogTimeSeries_citySDT"></div>
                    </div>
                    <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                        <div class="col h-100 pl-0"
                             id="serviceDeliveryDurationTimeSeries_citySDT"></div>
                        <div class="col h-100 pr-0"
                             id="serviceDeliveryServiceStandardTimeSeries_citySDT"></div>
                    </div>
                    <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                        <div class="col h-100 pl-0"
                             id="serviceDeliveryGrowthVolumeScatter_citySDT"></div>
                        <div class="col h-100 pr-0"
                             id="serviceDeliveryVolumeBacklogScatter_citySDT"></div>
                    </div>
                    <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                        <div class="col h-100 pl-0"
                             id="serviceDeliveryServiceStandardVolume_citySDT"></div>
                        <div class="col h-100 pr-0"
                             id="serviceDeliveryVolumeServiceStandardScatter_citySDT"></div>
                    </div>
                    <div class="row row-cols-1 pt-2 px-0" style="height:80vh"
                         id="serviceDeliveryServiceStandardBacklog_citySDT">
                    </div>
                </div>
            </div>

            {% for dept_title, directorate_filename_prefix, department_filename_prefix in
            service_delivery_turnaround_tuples %}
                <!-- {{ department_filename_prefix }} -->
                <div id="{{ department_filename_prefix }}SDT" class="container-fluid mt-2 pt-2 border-top px-3">
                    <div class="row row-cols-4 mt-1 py-0" style="min-height:7rem;height:7vh">
                        <div class="col h-100">
                            <div class="row h-3"></div>
                            <div class="row">
                                <div class="btn text-white collapsed text-left" data-toggle="collapse"
                                     href="#{{ department_filename_prefix }}SDT_Expanded"
                                     role="button" aria-expanded="false"
                                     aria-controls="{{ department_filename_prefix }}SDT_Expanded">
                                    <h2 class="text-left"><span class="expandControl">▼</span>
                                        <span>{{ dept_title }}</span></h2>
                                </div>
                            </div>
                            <div class="row h-3"></div>
                        </div>
                        <div class="col h-100 w-100"
                             id="serviceDeliveryBacklog_{{ department_filename_prefix }}SDT"></div><div class="col h-100 w-100"
                             id="serviceDeliveryLongBacklog_{{ department_filename_prefix }}SDT"></div>
                        <div class="col h-100 w-100"
                             id="serviceDeliveryStandard_{{ department_filename_prefix }}SDT"></div>
                    </div>

                    <div class="mt-2 px-3 collapse" style="height:60vh"
                         id="{{ department_filename_prefix }}SDT_Expanded">
                        <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                            <div class="col h-100 pl-0"
                                 id="serviceDeliveryVolumeTimeSeries_{{ department_filename_prefix }}SDT"></div>
                            <div class="col h-100 pr-0"
                                 id="serviceDeliveryBacklogTimeSeries_{{ department_filename_prefix }}SDT"></div>
                        </div>
                        <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                            <div class="col h-100 pl-0"
                                 id="serviceDeliveryAgeAnalysis_{{ department_filename_prefix }}SDT"></div>
                            <div class="col h-100 pr-0"
                                 id="serviceDeliveryLongBacklogTimeSeries_{{ department_filename_prefix }}SDT"></div>
                        </div>
                        <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                            <div class="col h-100 pl-0"
                                 id="serviceDeliveryDurationTimeSeries_{{ department_filename_prefix }}SDT"></div>
                            <div class="col h-100 pr-0"
                                 id="serviceDeliveryServiceStandardTimeSeries_{{ department_filename_prefix }}SDT"></div>
                        </div>
                        <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                            <div class="col h-100 pl-0"
                                 id="serviceDeliveryGrowthVolumeScatter_{{ department_filename_prefix }}SDT"></div>
                            <div class="col h-100 pr-0"
                                 id="serviceDeliveryVolumeBacklogScatter_{{ department_filename_prefix }}SDT"></div>
                        </div>
                        <div class="row row-cols-2 pt-2 px-0" style="height:23.5rem">
                            <div class="col h-100 pl-0"
                                 id="serviceDeliveryServiceStandardVolume_{{ department_filename_prefix }}SDT"></div>
                            <div class="col h-100 pr-0"
                                 id="serviceDeliveryVolumeServiceStandardScatter_{{ department_filename_prefix }}SDT"></div>
                        </div>
                        <div class="row row-cols-1 pt-2 px-0" style="height:80vh"
                             id="serviceDeliveryServiceStandardBacklog_{{ department_filename_prefix }}SDT">
                        </div>
                    </div>
                </div>
            {% endfor %}

            <h3>General</h3>
            <div id="city" class="container-fluid mt-2 pt-2 border-top px-3">
                <div class="row row-cols-4 mt-1 py-0" style="min-height:8rem;height:8vh">
                    <div class="col h-100 w-100" id="staffWorking_city"></div>
                    <div class="col h-100 w-100" id="staffAssessed_city"></div>
                    <div class="col h-100 w-100" id="serviceDeliveryBacklog_city"></div>
                    <div class="col h-100 w-100" id="serviceDeliveryStandard_city"></div>
                </div>

                <div class="row row-cols-1 mt-2 pt-2" style="height: 90vh"
                     id="serviceDeliveryMapCard"></div>

                <div class="row row-cols-2 pt-2 px-0" style="height:30rem">
                    <div class="col h-100 pl-0"
                         id="serviceRequestTimeSeries_city"></div>
                    <div class="col h-100 pr-0"
                         id="hRTimeSeries_city"></div>
                </div>
                <div class="row row-cols-2 mt-2 pt-2" style="height:30rem">
                    <div class="col-8 pr-1 pl-0 h-100" id="hrOrgUnitStatus_city"></div>
                    <div class="col-4 pl-1 pr-0 h-100" id="ohsPositiveCases_city"></div>
                </div>
            </div>

            {% for directorate_title, directorate_filename_prefix, sr_flag, hr_flag, depts_tuple in directorate_tuples %}
                <!-- {{ directorate_title }} -->
                <div id="{{ directorate_filename_prefix }}" class="container-fluid mt-2 pt-2 border-top">
                    <div class="row row-cols-5" style="min-height:8rem;height:8vh"
                         id="stats_{{ directorate_filename_prefix }}">
                        <div class="col h-100">
                            <div class="row h-5"></div>
                            <div class="row">
                                <div class="btn text-white collapsed text-left" data-toggle="collapse"
                                     href="#{{ directorate_filename_prefix }}_Expanded"
                                     role="button" aria-expanded="false"
                                     aria-controls="{{ directorate_filename_prefix }}_Expanded">
                                    <h4 class="text-left"><span class="expandControl">▼</span>
                                        <span>{{ directorate_title }} </span></h4>
                                </div>
                            </div>
                            <div class="row h-5"></div>
                        </div>
                        <div class="col h-100" id="staffWorking_{{ directorate_filename_prefix }}"></div>
                        <div class="col h-100" id="staffAssessed_{{ directorate_filename_prefix }}"></div>
                        <div class="col h-100" id="serviceDeliveryBacklog_{{ directorate_filename_prefix }}"></div>
                        <div class="col h-100" id="serviceDeliveryStandard_{{ directorate_filename_prefix }}"></div>
                    </div>

                    <div class="mt-2 px-3 collapse" style="height:60vh" id="{{ directorate_filename_prefix }}_Expanded">
                        {% set num_cols = 0 %}
                        {% set num_cols = num_cols + (1 if sr_flag else 0) %}
                        {% set num_cols = num_cols + (1 if hr_flag else 0) %}
                        <div class="row row-cols-{{ num_cols }} mt-2 pt-2" style="height:30rem">
                            {% if sr_flag -%}
                                <div class="col pl-1 {{ '' if hr_flag else 'pr-0' }} h-100"
                                     id="serviceRequestTimeSeries_{{ directorate_filename_prefix }}"></div>
                            {% endif -%}
                            {% if hr_flag -%}
                                <div class="col pl-1 pr-0 h-100"
                                     id="hRTimeSeries_{{ directorate_filename_prefix }}"></div>
                            {% endif -%}
                        </div>

                        {% if sr_flag -%}
                            <div class="row row-cols-1 mt-2 pt-2" style="height:30rem"
                                 id="allServiceRequestFocusMap_{{ directorate_filename_prefix }}"></div>
                        {% endif -%}

                        {% if hr_flag -%}
                            <div class="row row-cols-2 mt-2 pt-2" style="height:30rem">
                                <div class="col-8 pr-1 pl-0 h-100"
                                     id="hrOrgUnitStatus_{{ directorate_filename_prefix }}"></div>
                                <div class="col-4 pl-1 pr-0 h-100"
                                     id="ohsPositiveCases_{{ directorate_filename_prefix }}"></div>
                            </div>
                            {%- for dept_name in depts_tuple -%}
                                {% set dept_file_prefix = dept_name[:dept_name.index("(")] if "(" in dept_name else dept_name %}
                                {% set dept_file_prefix = dept_file_prefix.strip().lower().replace(" ", "_") %}
                                <div class="row row-cols-1 mt-2 pt-2" style="height:30rem"
                                     id="hRTimeSeries_{{ directorate_filename_prefix }}_{{ dept_file_prefix }}"></div>
                            {%- endfor -%}
                        {% endif -%}

                    </div>
                </div>
            {% endfor %}

        </div>

        <div id="footerPlaceholder" class="container-fluid py-0 px-3"></div>
    </div>
</div>

<!-- bootstrap scripts -->
<script src="assets/js/jquery-3.4.1.min.js"></script>

<!-- custom code for dynamically updating data -->
<script src="assets/js/numeral.min.js"></script>
<script src="assets/js/update_dash.js"></script>
<script>
    $(() => {
        // General
        // Disclaimers
        addGeneralDisclaimerAlert("disclaimer");
        addBetaDisclaimerAlert("betaDisclaimer");

        // Stat Widgets
        var lastUpdateTextDiv = addStatCard("lastUpdatedStatCard", "assets/imgs/clock-regular.svg", "Last Updated");
        var sATestedTextDiv = addStatCard("sATestedStatCard", "assets/imgs/notes-medical-solid.svg", "Tests Conducted (SA)");
        var casesTextDiv = addStatCard("casesStatCard", "assets/imgs/ambulance-solid.svg", "Total Cases (w/w trend)");
        var deathsTextDiv = addStatCard("deathsStatCard", "assets/imgs/skull-solid.svg", "Deaths (w/w trend)");

        setStatCardValue(lastUpdateTextDiv, 'widgets/private/latest_values.json', 'ct_latest_update');
        setStatCardValue(sATestedTextDiv, 'widgets/private/latest_values.json', 'rsa_latest_tested', "", true);

        setStatCardNestedValueWithTrend(casesTextDiv, "casesStatCardElement", 'widgets/private/case_count_maps/city_all_district_case_count.json',
            ["All", "total_count"], ["All", "latest_relative_increase"]);
        setStatCardNestedValueWithTrend(deathsTextDiv, "deathsStatCardElement", 'widgets/private/case_count_maps/city_all_district_case_count.json',
            ["Deaths", "total_count"], ["Deaths", "latest_relative_increase"], "", true);

        addCard("cityCasesPlot", "widgets/private/ct-cov2-daily-cases.html", 'Cases over Time');
        addCard("cityDeathsPlot", "widgets/private/ct-cov2-daily-deaths.html", 'Fatalities over Time');
        addCard("cityGenAdmissionsPlot", "widgets/private/ct-cov2-daily-gen-admissions.html", 'General Hospital Admissions over Time');
        addCard("cityIcuAdmissionsPlot", "widgets/private/ct-cov2-daily-icu-admissions.html", 'ICU Hospital Admissions over Time');

        addTabbedCard("tableCard",
            [
                {
                    tabId: "tableCardTabAbsolute",
                    iframeLink: "widgets/private/subdistrict_stats_table_widgets/city_covid19_subdistrict_stats_table.html",
                    titleString: "Absolute"
                },
                {
                    tabId: "tableCardTabPerCapita",
                    iframeLink: "widgets/private/subdistrict_stats_table_widgets/city_per_capita_covid19_subdistrict_stats_table.html",
                    titleString: "Per Capita"
                }
            ],
            "Subdistrict Summary");


        addCard("fatalityForecast", "https://ds2.capetown.gov.za/covid-fatalities-management/widgets/daily_total_ct_deaths_forecast.html",
            "Fatality Forecast <small>(based off hospitalisations)</small>");

        addCard("cityNewCaseChart", "widgets/private/ct_daily_counts_bar_chart.html", "New City Cases over Time");

        addFooter("footerPlaceholder");

        // District Specific
        {%- for district_name, district_filename_prefix in district_tuples %}
            // {{ district_name }}
            {%- set district_title = district_name.title().replace(" ", "_") %}
            {%- set plot_prefix = "cct_City_of_Cape_Town_-_" + district_title %}
            addCard("{{ plot_prefix }}_DailyCounts", "widgets/private/{{ plot_prefix }}_daily_counts_bar_chart.html",
                'Daily Cases over Time');
            addCard("{{ plot_prefix }}_CumulativeCount", "widgets/private/{{ plot_prefix }}_cumulative_counts.html",
                'Cumulative Cases over Time');

            var cumulativeCasesText_{{ district_filename_prefix }} = addStatCard("cumulativeCases_{{ district_filename_prefix }}", "assets/imgs/clipboard-regular.svg", "Total Cases (w/w trend)");
            setStatCardNestedValueWithTrend(cumulativeCasesText_{{ district_filename_prefix }}, "cumulativeCases_{{ district_filename_prefix }}Element",
                'widgets/private/case_count_maps/city_{{ district_filename_prefix }}_district_case_count.json',
                ["All", "total_count"], ["All", "latest_relative_increase"]);

            var activeCasesText_{{ district_filename_prefix }} = addStatCard("activeCases_{{ district_filename_prefix }}", "assets/imgs/ambulance-solid.svg", "Active Cases (w/w trend)");
            setStatCardNestedValueWithTrend(activeCasesText_{{ district_filename_prefix }}, "activeCases_{{ district_filename_prefix }}Element",
                'widgets/private/case_count_maps/city_{{ district_filename_prefix }}_district_case_count.json',
                ["Active", "total_count"], ["Active", "latest_relative_increase"], "", true);

            var cumulativeDeathsText_{{ district_filename_prefix }} = addStatCard("cumulativeDeaths_{{ district_filename_prefix }}", "assets/imgs/skull-solid.svg", "Deaths (w/w trend)");
            setStatCardNestedValueWithTrend(cumulativeDeathsText_{{ district_filename_prefix }}, "cumulativeDeaths_{{ district_filename_prefix }}Element",
                'widgets/private/case_count_maps/city_{{ district_filename_prefix }}_district_case_count.json',
                ["Deaths", "total_count"], ["Deaths", "latest_relative_increase"], "", true);
        {% endfor %}

        // Socioeconomic Vulnerability
        var lastUpdateTextDiv = addStatCard("lastUpdatedSocioeconomicStatCard", "assets/imgs/clock-regular.svg", "Last Updated");
        setStatCardNestedValue(lastUpdateTextDiv, 'widgets/private/business_continuity_city_socioeconomic_values.json',
            ['GDP Growth', '2020 Projections', 'metrics', 'date']);

        var gdpText = addStatCard("gdpStatCard", "assets/imgs/chart-line-solid.svg", "GDP Growth<br>(vs 2019)");
        setStatCardNestedValueWithTrend(gdpText, "gdpStatCardElement",
            'widgets/private/business_continuity_city_socioeconomic_values.json',
            ['GDP Growth', '2020 Projections', 'metrics', 'value'], ['GDP Growth', '2020 Projections', 'metrics-delta', 'value'],
            percent_val = true, increase_bad = false);

        var unemploymentText = addStatCard("unemploymentStatCard", "assets/imgs/briefcase-solid.svg", "Unemployment Rate<br>(vs 2019)");
        setStatCardNestedValueWithTrend(unemploymentText, "unemploymentStatCardElement",
            'widgets/private/business_continuity_city_socioeconomic_values.json',
            ['Unemployment', 'Projection', 'metrics', 'value'], ['Unemployment', 'Projection', 'metrics-delta', 'value'],
            percent_val = true, increase_bad = true);

        var povertyText = addStatCard("povertyStatCard", "assets/imgs/money-bill-solid.svg", "Upper-bound Poverty Rate<br>(vs 2018)");
        setStatCardNestedValueWithTrend(povertyText, "povertyStatCardElement",
            'widgets/private/business_continuity_city_socioeconomic_values.json',
            ['Poverty', "Post-Covid19 projection (Case 1: neutral distribution across each household per decile)", 'metrics', 'value'],
            ['Poverty', "Post-Covid19 projection (Case 1: neutral distribution across each household per decile)", 'metrics-delta', 'value'],
            percent_val = true, increase_bad = true);

        addTabbedCard("socioEconomicTimeseriesCard",
            [
                {
                    tabId: "gdp",
                    iframeLink: "widgets/private/business_continuity_city_socioeconomic_gdp_growth_ts_plot.html",
                    titleString: "GDP"
                },
                {
                    tabId: "unemployment",
                    iframeLink: "widgets/private/business_continuity_city_socioeconomic_unemployment_ts_plot.html",
                    titleString: "Unemployment"
                },
                {
                    tabId: "poverty",
                    iframeLink: "widgets/private/business_continuity_city_socioeconomic_poverty_ts_plot.html",
                    titleString: "Poverty"
                }
            ],
            "2020 Socio-economic Projections");

        // Citywide
        // Service Delivery Turnaround
        var serviceDeliveryBacklogText_citySDT = addStatCard("serviceDeliveryBacklog_citySDT", "assets/imgs/chart-line-solid.svg", "Backlog Size<br>(vs 2020-10-12)");
        setStatCardNestedValueWithTrend(serviceDeliveryBacklogText_citySDT, "serviceDeliveryBacklog_citySDTElement",
            'widgets/private/business_continuity_service_delivery_values.json',
            ["city", "metrics", "backlog"], ["city", "metrics-delta-relative", "backlog"]);

        var serviceDeliveryLongBacklogText_citySDT = addStatCard("serviceDeliveryLongBacklog_citySDT", "assets/imgs/hourglass-end-solid.svg", "% Open > 180 days<br>(vs 2020-10-12)");
        setStatCardNestedValueWithTrend(serviceDeliveryLongBacklogText_citySDT, "serviceDeliveryLongBacklog_citySDTElement",
            'widgets/private/business_continuity_service_delivery_values.json',
            ["city", "metrics", "long_backlog"], ["city", "metrics-delta", "long_backlog"], percent_val = true);

        var serviceDeliveryStandardText_citySDT = addStatCard("serviceDeliveryStandard_citySDT", "assets/imgs/clock-solid.svg", "% Within Target<br>(vs 2020-10-12)");
        setStatCardNestedValueWithTrend(serviceDeliveryStandardText_citySDT, "serviceDeliveryStandard_citySDTElement",
            'widgets/private/business_continuity_service_delivery_values.json',
            ["city", "metrics", "service_standard"], ["city", "metrics-delta", "service_standard"],
            percent_val = true, increase_bad = false);

        addCard("serviceDeliveryVolumeTimeSeries_citySDT",
            "widgets/private/business_continuity_city_service_delivery_volume_plot.html",
            'Service Requests Volumes');
        addCard("serviceDeliveryBacklogTimeSeries_citySDT",
            "widgets/private/business_continuity_service_delivery_city_backlog_plot.html",
            'Service Delivery Backlog');

        addCard("serviceDeliveryAgeAnalysis_citySDT",
            "widgets/private/business_continuity_city_service_delivery_request_distribution_plot.html",
            'Open Requests Age Distribution');
        addCard("serviceDeliveryLongBacklogTimeSeries_citySDT",
            "widgets/private/business_continuity_service_delivery_city_long_backlog_plot.html",
            'Service Requests Open > 180 days');

        addCard("serviceDeliveryServiceStandardTimeSeries_citySDT",
            "widgets/private/business_continuity_service_delivery_city_service_standard_plot.html",
            'Service Delivery Standards');
        addCard("serviceDeliveryDurationTimeSeries_citySDT",
            "widgets/private/business_continuity_city_service_request_duration_plot.html",
            'Service Request Duration');

        addCard("serviceDeliveryGrowthVolumeScatter_citySDT",
            "widgets/private/business_continuity_service_delivery_city_volume_growth_plot.html",
            'Request Type Backlog Growth');
        addCard("serviceDeliveryVolumeBacklogScatter_citySDT",
            "widgets/private/business_continuity_service_delivery_metric_biplots/business_continuity_service_delivery_city_request_backlog.html",
            'Request Type Volume vs Backlog');

        addCard("serviceDeliveryServiceStandardVolume_citySDT",
            "widgets/private/business_continuity_service_delivery_city_volume_perf_plot.html",
            'Request Type Volume Within Target');
        addCard("serviceDeliveryVolumeServiceStandardScatter_citySDT",
            "widgets/private/business_continuity_service_delivery_metric_biplots/business_continuity_service_delivery_city_request_percent_closed.html",
            'Request Type Volume vs Service Standard');

        addCard("serviceDeliveryServiceStandardBacklog_citySDT",
            "widgets/private/business_continuity_service_delivery_metric_quadrants/business_continuity_service_delivery_city_request_backlog_service_std.html",
            'Request Type Backlog vs Service Standard');

        {% for dept_title, directorate_filename_prefix, department_filename_prefix in service_delivery_turnaround_tuples %}
            var serviceDeliveryBacklogText_{{ department_filename_prefix }}SDT = addStatCard("serviceDeliveryBacklog_{{ department_filename_prefix }}SDT", "assets/imgs/chart-line-solid.svg", "Backlog Size<br>(vs 2020-10-12)");
            setStatCardNestedValueWithTrend(serviceDeliveryBacklogText_{{ department_filename_prefix }}SDT, "serviceDeliveryBacklog_{{ department_filename_prefix }}SDTElement",
                'widgets/private/business_continuity_service_delivery_values.json',
                ["city", '{{ directorate_filename_prefix }}', '{{ department_filename_prefix }}', "metrics", "backlog"],
                ["city", '{{ directorate_filename_prefix }}', '{{ department_filename_prefix }}', "metrics-delta-relative", "backlog"]);

            var serviceDeliveryLongBacklogText_{{ department_filename_prefix }}SDT = addStatCard("serviceDeliveryLongBacklog_{{ department_filename_prefix }}SDT", "assets/imgs/hourglass-end-solid.svg", "% Open > 180 days<br>(vs 2020-10-12)");
            setStatCardNestedValueWithTrend(serviceDeliveryLongBacklogText_{{ department_filename_prefix }}SDT, "serviceDeliveryLongBacklog_{{ department_filename_prefix }}SDTElement",
                'widgets/private/business_continuity_service_delivery_values.json',
                ["city", '{{ directorate_filename_prefix }}', '{{ department_filename_prefix }}', "metrics", "long_backlog"],
                ["city", '{{ directorate_filename_prefix }}', '{{ department_filename_prefix }}', "metrics-delta", "long_backlog"],
                percent_val = true);

            var serviceDeliveryStandardText_{{ department_filename_prefix }}SDT = addStatCard("serviceDeliveryStandard_{{ department_filename_prefix }}SDT", "assets/imgs/clock-solid.svg", "% Within Target<br>(vs 2020-10-12)");
            setStatCardNestedValueWithTrend(serviceDeliveryStandardText_{{ department_filename_prefix }}SDT, "serviceDeliveryStandard_{{ department_filename_prefix }}SDTElement",
                'widgets/private/business_continuity_service_delivery_values.json',
                ["city", '{{ directorate_filename_prefix }}', '{{ department_filename_prefix }}', "metrics", "service_standard"],
                ["city", '{{ directorate_filename_prefix }}', '{{ department_filename_prefix }}', "metrics-delta", "service_standard"],
                percent_val = true, increase_bad = false);

            addCard("serviceDeliveryVolumeTimeSeries_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_city_{{ directorate_filename_prefix }}_{{ department_filename_prefix }}_service_delivery_volume_plot.html",
                'Service Requests Volumes');
            addCard("serviceDeliveryBacklogTimeSeries_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_city_{{ directorate_filename_prefix }}_{{ department_filename_prefix }}_backlog_plot.html",
                'Service Delivery Backlog');

            addCard("serviceDeliveryAgeAnalysis_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_city_{{ directorate_filename_prefix }}_{{ department_filename_prefix }}_service_delivery_request_distribution_plot.html",
                'Open Requests Age Distribution');
            addCard("serviceDeliveryLongBacklogTimeSeries_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_city_{{ directorate_filename_prefix }}_{{ department_filename_prefix }}_long_backlog_plot.html",
                'Service Requests Open > 180 days');

            addCard("serviceDeliveryDurationTimeSeries_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_city_{{ directorate_filename_prefix }}_{{ department_filename_prefix }}_service_request_duration_plot.html",
                'Service Request Duration');
            addCard("serviceDeliveryServiceStandardTimeSeries_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_city_{{ directorate_filename_prefix }}_{{ department_filename_prefix }}_service_standard_plot.html",
                'Service Delivery Standards');

            {% set directorate_prefix = directorate_filename_prefix if directorate_filename_prefix != 'water_and_waste' else 'water_and_waste_services' %}
            addCard("serviceDeliveryGrowthVolumeScatter_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_city_{{ directorate_prefix }}_{{ department_filename_prefix }}_volume_growth_plot.html",
                'Request Type Backlog Growth');
            addCard("serviceDeliveryVolumeBacklogScatter_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_metric_biplots/business_continuity_service_delivery_city_{{ directorate_prefix }}_{{ department_filename_prefix }}_request_backlog.html",
                'Request Type Volume vs Backlog');

            addCard("serviceDeliveryServiceStandardVolume_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_city_{{ directorate_prefix }}_{{ department_filename_prefix }}_volume_perf_plot.html",
                'Request Type Volume Within Target');
            addCard("serviceDeliveryVolumeServiceStandardScatter_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_metric_biplots/business_continuity_service_delivery_city_{{ directorate_prefix }}_{{ department_filename_prefix }}_request_percent_closed.html",
                'Request Type Volume vs Service Standard');

            addCard("serviceDeliveryServiceStandardBacklog_{{ department_filename_prefix }}SDT",
                "widgets/private/business_continuity_service_delivery_metric_quadrants/business_continuity_service_delivery_request_city_{{ department_filename_prefix }}_backlog_service_std.html",
                'Request Type Backlog vs Service Standard');
        {% endfor %}

        // General
        var serviceDeliveryBacklogText_city = addStatCard("serviceDeliveryBacklog_city", "assets/imgs/chart-line-solid.svg", "Backlog Size<br><small>(vs 2020-10-12)</small>");
        setStatCardNestedValueWithTrend(serviceDeliveryBacklogText_city, "serviceDeliveryBacklog_cityElement",
            'widgets/private/business_continuity_service_delivery_values.json',
            ["city", "metrics", "backlog"], ["city", "metrics-delta-relative", "backlog"]);

        var serviceDeliveryStandardText_city = addStatCard("serviceDeliveryStandard_city", "assets/imgs/clock-solid.svg", "% Within Target<br><small>(vs 2020-10-12)</small>");
        setStatCardNestedValueWithTrend(serviceDeliveryStandardText_city, "serviceDeliveryStandard_cityElement",
            'widgets/private/business_continuity_service_delivery_values.json',
            ["city", "metrics", "service_standard"], ["city", "metrics-delta", "service_standard"],
            percent_val = true, increase_bad = false);

        addCard("serviceRequestTimeSeries_city",
            "widgets/private/business_continuity_city_service_request_count_plot.html",
            'Service Requests over Time <small><a class="text-white" href="#serviceRequestMap_city">(<u>more detail</u>)</a></small>');

        var staffWorkingText_city = addStatCard("staffWorking_city", "assets/imgs/cogs-solid.svg", "Staff Working / Assessed");
        var staffAssessedText_city = addStatCard("staffAssessed_city", "assets/imgs/clipboard-regular.svg", "Staff Assessed / Total");

        setStatCardValueFractions(staffWorkingText_city,
            'widgets/private/business_continuity_city_values.json',
            'city_staff_at_work', 'city_staff_reported', true, true);
        setStatCardValueFractions(staffAssessedText_city,
            'widgets/private/business_continuity_city_values.json',
            'city_staff_reported', 'city_staff_total', true, true);

        addCard("hRTimeSeries_city",
            "widgets/private/business_continuity_city_hr_absenteeism_plot.html",
            'HR Capacity over Time <small><a class="text-white" href="#hrOrgUnitStatus_city">(<u>more detail</u>)</a></small>');

        addCard("hrOrgUnitStatus_city",
            "widgets/private/business_continuity_city_hr_unitstatus_plot.html",
            "Organisational Unit Status");
        addCard("ohsPositiveCases_city",
            "widgets/private/city_ohs_cases_plot.html",
            "Covid-19 Cases (<small>as reported to OHS</small>)");

        // Directorate Specific
        {%- for directorate_title, directorate_filename_prefix, sr_flag, hr_flag, depts_tuple in directorate_tuples %}
            // {{ directorate_title }}
            {% if sr_flag -%}
                var serviceDeliveryBacklogText_{{ directorate_filename_prefix }} = addStatCard("serviceDeliveryBacklog_{{ directorate_filename_prefix }}", "assets/imgs/chart-line-solid.svg", "Backlog Size<br><small>(vs 2020-10-12)</small>");
                setStatCardNestedValueWithTrend(serviceDeliveryBacklogText_{{ directorate_filename_prefix }}, "serviceDeliveryBacklog_{{ directorate_filename_prefix }}Element",
                    'widgets/private/business_continuity_service_delivery_values.json',
                    ["city", "{{ directorate_filename_prefix }}", "metrics", "backlog"],
                    ["city", "{{ directorate_filename_prefix }}", "metrics-delta-relative", "backlog"]);

                var serviceDeliveryStandardText_{{ directorate_filename_prefix }} = addStatCard("serviceDeliveryStandard_{{ directorate_filename_prefix }}", "assets/imgs/clock-solid.svg", "% Within Target<br><small>(vs 2020-10-12)</small>");
                setStatCardNestedValueWithTrend(serviceDeliveryStandardText_{{ directorate_filename_prefix }}, "serviceDeliveryStandard_{{ directorate_filename_prefix }}Element",
                    'widgets/private/business_continuity_service_delivery_values.json',
                    ["city", "{{ directorate_filename_prefix }}", "metrics", "service_standard"],
                    ["city", "{{ directorate_filename_prefix }}", "metrics-delta", "service_standard"],
                    percent_val = true, increase_bad = false);

                addCard("serviceRequestTimeSeries_{{ directorate_filename_prefix }}",
                    "widgets/private/business_continuity_{{ directorate_filename_prefix }}_service_request_count_plot.html",
                    'Service Requests over Time <small><a class="text-white" href="#serviceRequestMap_{{ directorate_filename_prefix }}">(<u>more detail</u>)</a></small>');

                addTabbedCard("allServiceRequestFocusMap_{{ directorate_filename_prefix }}",
                    [
                        {%- for service_period_time_period_prefix, service_period_time_period_title in service_request_time_periods %}
                            {
                                tabId: "focusMapTab_{{ service_period_time_period_prefix }}_{{ directorate_filename_prefix }}",
                                iframeLink: "widgets/private/business_continuity_service_request_map/{{ service_period_time_period_prefix }}_{{ directorate_filename_prefix }}_focused_map.html",
                                titleString: "{{ service_period_time_period_title }}"
                            }{{ "," if not loop.last else "" }}
                        {%- endfor %}
                    ],
                    "Service Requests over Space");

            {% endif -%}
            {% if hr_flag -%}
                var staffWorkingText_{{ directorate_filename_prefix }} = addStatCard("staffWorking_{{ directorate_filename_prefix }}",
                    "assets/imgs/cogs-solid.svg", "Staff Working/Assessed");
                var staffAssessedText_{{ directorate_filename_prefix }} = addStatCard("staffAssessed_{{ directorate_filename_prefix }}",
                    "assets/imgs/clipboard-regular.svg", "Staff Assessed/Total");

                setStatCardValueFractions(staffWorkingText_{{ directorate_filename_prefix }},
                    'widgets/private/business_continuity_{{ directorate_filename_prefix }}_values.json',
                    '{{ directorate_filename_prefix }}_staff_at_work', '{{ directorate_filename_prefix }}_staff_reported', true, true);
                setStatCardValueFractions(staffAssessedText_{{ directorate_filename_prefix }},
                    'widgets/private/business_continuity_{{ directorate_filename_prefix }}_values.json',
                    '{{ directorate_filename_prefix }}_staff_reported', '{{ directorate_filename_prefix }}_staff_total', true, true);

                addCard("hRTimeSeries_{{ directorate_filename_prefix }}",
                    "widgets/private/business_continuity_{{ directorate_filename_prefix }}_hr_absenteeism_plot.html",
                    'HR Capacity over Time <small><a class="text-white" href="#hrOrgUnitStatus_{{ directorate_filename_prefix }}">(<u>more detail</u>)</a></small>');

                addCard("hrOrgUnitStatus_{{ directorate_filename_prefix }}",
                    "widgets/private/business_continuity_{{ directorate_filename_prefix }}_hr_unitstatus_plot.html",
                    "Organisational Unit Status");
                addCard("ohsPositiveCases_{{ directorate_filename_prefix }}",
                    "widgets/private/{{ directorate_filename_prefix }}_ohs_cases_plot.html",
                    "Covid-19 Cases (<small>as reported to OHS</small>)");
                {%- for dept_name in depts_tuple -%}
                    {% set dept_file_prefix = dept_name[:dept_name.index("(")] if "(" in dept_name else dept_name %}
                    {% set dept_file_prefix = dept_file_prefix.strip().lower().replace(" ", "_") %}
                    addCard("hRTimeSeries_{{ directorate_filename_prefix }}_{{ dept_file_prefix }}",
                        "widgets/private/business_continuity_{{ directorate_filename_prefix }}_{{ dept_file_prefix }}_hr_absenteeism_plot.html",
                        '{{ dept_name.lower().title() }} Dept. HR Capacity over Time');
                {%- endfor -%}
            {% endif -%}
        {% endfor %}

        setTimeout(function () {
            addCard("serviceDeliveryMapCard", "widgets/private/business_continuity_service_request_map/city_service_delivery_map_widget.html", "Service Delivery Spatial Data");
        }, 5000);

        setTimeout(function () {
            addCard("mapCard", "widgets/private/case_count_maps/city_all_hotspot_map_widget.html", "Socio-economic Spatial Data");
        }, 5000);

        setTimeout(function () {
            addBackgroundVideoSrc("backgroundVideoSrc", "backgroundVideo", "assets/imgs/table_mountain.mp4");
        }, 10000);
    });</script>

<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

</body>

</html>